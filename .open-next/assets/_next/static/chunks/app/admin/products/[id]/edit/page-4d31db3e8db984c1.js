(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[435],{2069:function(e,a,t){Promise.resolve().then(t.bind(t,394))},9376:function(e,a,t){"use strict";var r=t(5475);t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(a,{useSearchParams:function(){return r.useSearchParams}})},394:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return c},dynamic:function(){return l}});var r=t(7437),s=t(2265),i=t(9376),n=t(6586);let l="force-dynamic";function c(e){let{params:a}=e,t=(0,i.useRouter)(),l=(0,s.useRef)(null),[c,d]=(0,s.useState)(!1),[o,m]=(0,s.useState)(!0),[u,x]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[v,b]=(0,s.useState)(""),[y,g]=(0,s.useState)(""),[f,j]=(0,s.useState)(!1),[N,k]=(0,s.useState)(!1),[C,w]=(0,s.useState)(!1),[D,S]=(0,s.useState)([]),[M,E]=(0,s.useState)([]),[R,z]=(0,s.useState)(!1),[q,U]=(0,s.useState)(""),[B,F]=(0,s.useState)({name:"",description:"",price:"",stock:"",category:"",carModel:"",carYear:""});(0,s.useEffect)(()=>{!async function(){let{id:e}=await a;U(e);try{let a=await fetch("/api/products/".concat(e)),t=await a.json();if(t.product){let e=t.product;F({name:e.name||"",description:e.description||"",price:String(e.price||""),stock:String(e.stock||""),category:e.category||"",carModel:e.carModel||"",carYear:e.carYear||""}),!n.bd.some(a=>a.id===e.category)&&e.category&&(w(!0),g(e.category));let a=n.EK.find(a=>a.name===e.carBrand);a?(x(a.id),!a.models.some(a=>a.name===e.carModel)&&e.carModel&&(k(!0),b(e.carModel))):e.carBrand&&(j(!0),p(e.carBrand),k(!0),b(e.carModel||"")),e.images&&e.images.length>0?(S(e.images),E(e.images)):e.imageUrl&&(S([e.imageUrl]),E([e.imageUrl]))}}catch(e){console.error("Error loading product:",e),alert("ไม่พบสินค้านี้"),t.push("/admin/products")}finally{m(!1)}}()},[a,t]);let P=async e=>{let a=e.target.files;if(a&&0!==a.length){z(!0);for(let e=0;e<a.length;e++){let t=a[e],r=new FileReader;r.onload=e=>{E(a=>{var t;return[...a,null===(t=e.target)||void 0===t?void 0:t.result]})},r.readAsDataURL(t);let s=new FormData;s.append("file",t);try{let e=await fetch("/api/upload",{method:"POST",body:s}),a=await e.json();a.success&&S(e=>[...e,a.imageUrl])}catch(e){alert("เกิดข้อผิดพลาดในการอัปโหลด")}}z(!1)}},K=e=>{S(a=>a.filter((a,t)=>t!==e)),E(a=>a.filter((a,t)=>t!==e))},Y=async e=>{e.preventDefault(),d(!0);let a=n.EK.find(e=>e.id===u),r=f?h:(null==a?void 0:a.name)||"",s=N?v:B.carModel,i=C?y:B.category;try{let e=await fetch("/api/products/".concat(q),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...B,price:Number(B.price),stock:Number(B.stock),carBrand:r,carModel:s,category:i,imageUrl:D[0]||"",images:D})}),a=await e.json();a.success?(alert("บันทึกเรียบร้อยแล้ว!"),t.push("/admin"),t.refresh()):alert("เกิดข้อผิดพลาด: "+a.error)}catch(e){alert("เกิดข้อผิดพลาด กรุณาลองใหม่")}finally{d(!1)}},_=n.EK.find(e=>e.id===u);return o?(0,r.jsx)("div",{className:"max-w-3xl mx-auto px-4 py-8 text-center",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3 mx-auto mb-4"}),(0,r.jsx)("div",{className:"h-64 bg-gray-100 rounded-2xl"})]})}):(0,r.jsxs)("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-[var(--text-primary)]",children:"แก้ไขสินค้า"}),(0,r.jsxs)("p",{className:"text-[var(--text-secondary)] mt-1",children:["ID: ",q]})]}),(0,r.jsxs)("form",{onSubmit:Y,className:"bg-white rounded-2xl border border-[var(--border)] p-6 md:p-8",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-2",children:"รูปภาพสินค้า"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-3 mb-3",children:[M.map((e,a)=>(0,r.jsxs)("div",{className:"relative w-24 h-24 rounded-xl overflow-hidden border-2 border-[var(--border)]",children:[(0,r.jsx)("img",{src:e,alt:"Preview ".concat(a+1),className:"w-full h-full object-cover"}),(0,r.jsx)("button",{type:"button",onClick:()=>K(a),className:"absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full text-xs hover:bg-red-600",children:"✕"})]},a)),(0,r.jsx)("div",{onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},className:"w-24 h-24 rounded-xl border-2 border-dashed border-[var(--border)] flex items-center justify-center cursor-pointer hover:border-[var(--primary)] transition-colors bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("span",{className:"text-2xl",children:"➕"}),(0,r.jsx)("p",{className:"text-xs text-[var(--text-muted)]",children:"เพิ่มรูป"})]})})]}),(0,r.jsx)("input",{ref:l,type:"file",accept:"image/*",multiple:!0,onChange:P,className:"hidden"}),R&&(0,r.jsx)("p",{className:"text-sm text-[var(--primary)]",children:"⏳ กำลังอัปโหลด..."})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-2",children:"ชื่อสินค้า *"}),(0,r.jsx)("input",{type:"text",required:!0,value:B.name,onChange:e=>F({...B,name:e.target.value}),className:"input-field"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-2",children:"รายละเอียด"}),(0,r.jsx)("textarea",{rows:4,value:B.description,onChange:e=>F({...B,description:e.target.value}),className:"input-field resize-none"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-2",children:"ราคา (บาท) *"}),(0,r.jsx)("input",{type:"number",required:!0,min:"0",value:B.price,onChange:e=>F({...B,price:e.target.value}),className:"input-field"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-2",children:"จำนวนสต็อก"}),(0,r.jsx)("input",{type:"number",min:"0",value:B.stock,onChange:e=>F({...B,stock:e.target.value}),className:"input-field"})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-2",children:"หมวดหมู่ *"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"customCategory",checked:C,onChange:e=>w(e.target.checked),className:"w-4 h-4"}),(0,r.jsx)("label",{htmlFor:"customCategory",className:"text-sm text-[var(--text-secondary)]",children:"พิมพ์หมวดหมู่เอง"})]}),C?(0,r.jsx)("input",{type:"text",required:!0,value:y,onChange:e=>g(e.target.value),className:"input-field",placeholder:"พิมพ์หมวดหมู่ใหม่..."}):(0,r.jsxs)("select",{required:!0,value:B.category,onChange:e=>F({...B,category:e.target.value}),className:"input-field",children:[(0,r.jsx)("option",{value:"",children:"เลือกหมวดหมู่"}),n.bd.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-2",children:"ยี่ห้อรถ *"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"customBrand",checked:f,onChange:e=>{j(e.target.checked),e.target.checked&&k(!0)},className:"w-4 h-4"}),(0,r.jsx)("label",{htmlFor:"customBrand",className:"text-sm text-[var(--text-secondary)]",children:"พิมพ์ยี่ห้อเอง"})]}),f?(0,r.jsx)("input",{type:"text",required:!0,value:h,onChange:e=>p(e.target.value),className:"input-field",placeholder:"พิมพ์ยี่ห้อรถใหม่..."}):(0,r.jsxs)("select",{required:!0,className:"input-field",value:u,onChange:e=>x(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"เลือกยี่ห้อ"}),n.EK.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-2",children:"รุ่นรถ *"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"customModel",checked:N,onChange:e=>k(e.target.checked),className:"w-4 h-4",disabled:f}),(0,r.jsx)("label",{htmlFor:"customModel",className:"text-sm text-[var(--text-secondary)]",children:"พิมพ์รุ่นเอง"})]}),N?(0,r.jsx)("input",{type:"text",required:!0,value:v,onChange:e=>b(e.target.value),className:"input-field",placeholder:"พิมพ์รุ่นรถใหม่..."}):(0,r.jsxs)("select",{required:!0,value:B.carModel,onChange:e=>F({...B,carModel:e.target.value}),className:"input-field",disabled:!u,children:[(0,r.jsx)("option",{value:"",children:"เลือกรุ่น"}),null==_?void 0:_.models.map(e=>(0,r.jsx)("option",{value:e.name,children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-2",children:"ปีรถ"}),(0,r.jsx)("input",{type:"text",value:B.carYear,onChange:e=>F({...B,carYear:e.target.value}),className:"input-field"})]}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{type:"button",onClick:()=>t.back(),className:"px-6 py-3 rounded-xl border-2 border-[var(--border)] text-[var(--text-secondary)] hover:bg-gray-50 transition-colors",children:"ยกเลิก"}),(0,r.jsx)("button",{type:"submit",disabled:c||R,className:"flex-1 btn-primary disabled:opacity-50",children:c?"กำลังบันทึก...":"บันทึกการเปลี่ยนแปลง"})]})]})]})}},6586:function(e,a,t){"use strict";t.d(a,{EK:function(){return s},bd:function(){return r}});let r=[{id:"engine",name:"เครื่องยนต์",icon:"⚙️",count:24},{id:"electrical",name:"ระบบไฟฟ้า",icon:"⚡",count:18},{id:"suspension",name:"ช่วงล่าง",icon:"\uD83D\uDD27",count:15},{id:"brake",name:"ระบบเบรค",icon:"\uD83D\uDED1",count:12},{id:"body",name:"ตัวถังและกระจก",icon:"\uD83D\uDE97",count:20},{id:"interior",name:"ภายในห้องโดยสาร",icon:"\uD83D\uDCBA",count:16},{id:"cooling",name:"ระบบระบายความร้อน",icon:"❄️",count:10},{id:"transmission",name:"ระบบส่งกำลัง",icon:"\uD83D\uDD29",count:8}],s=[{id:"toyota",name:"Toyota",models:[{id:"camry",name:"Camry",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"corolla",name:"Corolla Altis",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"yaris",name:"Yaris",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"hilux",name:"Hilux Revo",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"fortuner",name:"Fortuner",years:["2018","2019","2020","2021","2022","2023","2024"]}]},{id:"honda",name:"Honda",models:[{id:"civic",name:"Civic",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"accord",name:"Accord",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"city",name:"City",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"crv",name:"CR-V",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"hrv",name:"HR-V",years:["2018","2019","2020","2021","2022","2023","2024"]}]},{id:"mazda",name:"Mazda",models:[{id:"mazda2",name:"Mazda 2",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"mazda3",name:"Mazda 3",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"cx3",name:"CX-3",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"cx5",name:"CX-5",years:["2018","2019","2020","2021","2022","2023","2024"]}]},{id:"isuzu",name:"Isuzu",models:[{id:"dmax",name:"D-Max",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"mux",name:"MU-X",years:["2018","2019","2020","2021","2022","2023","2024"]}]},{id:"ford",name:"Ford",models:[{id:"ranger",name:"Ranger",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"everest",name:"Everest",years:["2018","2019","2020","2021","2022","2023","2024"]}]},{id:"nissan",name:"Nissan",models:[{id:"almera",name:"Almera",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"navara",name:"Navara",years:["2018","2019","2020","2021","2022","2023","2024"]},{id:"kicks",name:"Kicks",years:["2020","2021","2022","2023","2024"]}]}]}},function(e){e.O(0,[971,117,744],function(){return e(e.s=2069)}),_N_E=e.O()}]);
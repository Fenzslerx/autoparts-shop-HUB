"use strict";(()=>{var e={};e.id=898,e.ids=[898],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8925:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>E});var a={};r.r(a),r.d(a,{DELETE:()=>y,GET:()=>l,PUT:()=>g});var n=r(9303),o=r(8716),i=r(3131),c=r(7070),s=r(5748),u=r(3895),d=r(1615);async function p(){let e=(await (0,d.cookies)()).get("admin_auth");return e?.value==="authenticated"}async function l(e,{params:t}){let{id:r}=await t,a=await (0,s.gk)(r);return a?c.NextResponse.json({product:a}):c.NextResponse.json({error:"Product not found"},{status:404})}async function g(e,{params:t}){if(!await p())return c.NextResponse.json({error:"Unauthorized"},{status:401});let{id:r}=await t,a=await e.json(),n=await (0,s.nM)(r,{name:a.name,description:a.description,price:Number(a.price),carBrand:a.carBrand,carModel:a.carModel,carYear:a.carYear,category:a.category,imageUrl:a.imageUrl,images:a.images||[],stock:Number(a.stock),isActive:a.isActive});return n?(await (0,u.Ls)("update",{id:n.id,name:n.name}),c.NextResponse.json({success:!0,product:n})):c.NextResponse.json({error:"Product not found"},{status:404})}async function y(e,{params:t}){if(!await p())return c.NextResponse.json({error:"Unauthorized"},{status:401});let{id:r}=await t;return await (0,s.Ir)(r)?(await (0,u.Ls)("delete",{id:r}),c.NextResponse.json({success:!0})):c.NextResponse.json({error:"Product not found"},{status:404})}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"C:\\Users\\Field\\Desktop\\MAVARIX\\src\\app\\api\\products\\[id]\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:E,serverHooks:w}=m,_="/api/products/[id]/route";function x(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:E})}},3423:(e,t,r)=>{r.d(t,{A5:()=>i,OL:()=>n,yP:()=>c});var a=r(3358);async function n(e,t=[]){try{let{env:r}=(0,a.getRequestContext)(),n=r.DB;if(!n){console.error("DB binding not found in request context");let r=globalThis;if(r.process?.env?.DB&&"function"==typeof r.process.env.DB.prepare)return await o(r.process.env.DB,e,t);return[]}return await o(n,e,t)}catch(e){return console.error("D1 Execution Error",e),[]}}async function o(e,t,r){try{let a=e.prepare(t).bind(...r);return(await a.all()).results||[]}catch(e){throw console.error("Query Error",e),e}}async function i(){return await n("SELECT * FROM products WHERE is_active = 1 ORDER BY created_at DESC")}async function c(e){let t=`prod-${Date.now()}`,r=new Date().toISOString();return await n(`
    INSERT INTO products (id, name, description, price, car_brand, car_model, car_year, category, image_url, stock, is_active, created_at, updated_at)
    VALUES ('${t}', '${e.name}', '${e.description||""}', ${e.price}, '${e.carBrand}', '${e.carModel}', '${e.carYear||""}', '${e.category}', '${e.imageUrl||""}', ${e.stock||0}, 1, '${r}', '${r}')
  `),{...e,id:t,isActive:!0,createdAt:r,updatedAt:r}}},5748:(e,t,r)=>{r.d(t,{Ir:()=>c,Xp:()=>n,gk:()=>o,nM:()=>i});var a=r(3423);async function n(){try{return(await (0,a.A5)()).map(e=>({id:e.id,name:e.name,description:e.description,price:e.price,carBrand:e.car_brand,carModel:e.car_model,carYear:e.car_year,category:e.category,imageUrl:e.image_url,stock:e.stock,createdAt:e.created_at,updatedAt:e.updated_at}))}catch(e){return console.error("Error fetching products from D1:",e),[]}}async function o(e){try{let t=await (0,a.OL)("SELECT * FROM products WHERE id = ?",[e]);if(t&&t.length>0){let e=t[0];return{id:e.id,name:e.name,description:e.description,price:e.price,carBrand:e.car_brand,carModel:e.car_model,carYear:e.car_year,category:e.category,imageUrl:e.image_url,stock:e.stock,createdAt:e.created_at,updatedAt:e.updated_at}}return null}catch(e){return console.error("Error fetching product by ID:",e),null}}async function i(e,t){return new Date().toISOString(),null}async function c(e){return await (0,a.OL)("DELETE FROM products WHERE id = ?",[e]),!0}},3895:(e,t,r)=>{r.d(t,{Lh:()=>s,Ls:()=>i,gO:()=>c,p8:()=>u,yr:()=>o});var a=r(3423);async function n(e,t,r,n){let o=`log-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i=new Date().toISOString();try{await (0,a.OL)(`
        INSERT INTO logs (id, type, action, data, ip, user_agent, created_at)
        VALUES ('${o}', '${e}', '${t}', '${JSON.stringify(r).replace(/'/g,"''")}', '${n?.ip||""}', '${n?.userAgent||""}', '${i}')
      `)}catch(e){console.error("Log error",e)}return{id:o,type:e,action:t,timestamp:i,data:r,ip:n?.ip,userAgent:n?.userAgent}}async function o(e){let t="SELECT * FROM logs WHERE 1=1";return e?.type&&(t+=` AND type = '${e.type}'`),e?.startDate&&(t+=` AND created_at >= '${e.startDate}'`),e?.endDate&&(t+=` AND created_at <= '${e.endDate}'`),t+=" ORDER BY created_at DESC",e?.limit&&(t+=` LIMIT ${e.limit}`),(await (0,a.OL)(t)).map(e=>({id:e.id,type:e.type,action:e.action,timestamp:e.created_at,data:JSON.parse(e.data||"{}"),ip:e.ip,userAgent:e.user_agent}))}async function i(e,t){return n("product",e,t)}async function c(e,t,r){return n("auth",e,{username:t},{ip:r})}async function s(e,t,r){return n("visitor","page_view",{page:e,productId:t},r)}async function u(e,t,r){return n("contact","inquiry",{productId:e,productName:t},r)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,615,89],()=>r(8925));module.exports=a})();